{"storedProcedures":{"createLobby":"CREATE DEFINER=`root`@`localhost` PROCEDURE `createLobby`(\n\tIN ljson JSON\n)\nBEGIN\n\tinsert into lobby (lobbyjson) values (ljson);\n    select connID from lobby where id = LAST_INSERT_ID();\nEND","delLobby":"CREATE DEFINER=`root`@`localhost` PROCEDURE `delLobby`(\n\tIN lobbyconnID INT(5)\n)\nBEGIN\n\tdelete from lobby where connID = lobbyconnID;\nEND","disconnectUUID":"CREATE DEFINER=`root`@`localhost` PROCEDURE `disconnectUUID`(\n\tIN serUUID varchar(36)\n)\nBEGIN\n\tdeclare myID varchar(30);\n    declare users json;\n    declare curLeader json;\n    set myID = (select connID from lobby  where JSON_CONTAINS(lobbyjson -> '$.users[*].uuid', JSON_QUOTE(serUUID)));\n    update lobby set lobbyjson = JSON_REMOVE(lobbyjson, REPLACE(REPLACE(JSON_SEARCH(lobbyjson, 'one', serUUID), \".uuid\",\"\"),'\"','')) where JSON_CONTAINS(lobbyjson -> '$.users[*].uuid', JSON_QUOTE(serUUID));\n    delete from lobby where JSON_LENGTH(lobbyjson -> '$.users[*]') is NULL and connID = myID;\n    set users = (select lobbyjson -> '$.users[*]' as usrs from lobby where connID = myID);\n    set curLeader = (select lobbyjson -> '$.leader' as leader from lobby where connID = myID);\n    if STRCMP(curLeader, JSON_QUOTE(serUUID)) = 0 and users is not null then\n\t\tset curLeader = (select lobbyjson -> '$.users[0].uuid' as leader from lobby where connID = myID);\n\t\tupdate lobby set lobbyjson = JSON_SET(lobbyjson,'$.leader',curLeader) where connID = myID;\n    end if;\n    select myID as connID, cast(JSON_UNQUOTE(users) as json) as usrs, JSON_UNQUOTE(curLeader) as leader;\nEND","getconnIDbyGUID":"CREATE DEFINER=`root`@`localhost` PROCEDURE `getconnIDbyGUID`(\n\tIN serGUID varchar(40)\n)\nBEGIN\n\tselect connID from lobby where JSON_CONTAINS(lobbyjson -> '$.users[*].uuid', serGUID);\nEND","getLobby":"CREATE DEFINER=`root`@`localhost` PROCEDURE `getLobby`(\n\tIN lobbyconnID INT\n)\nBEGIN\n\tselect lobbyjson from lobby where connID = lobbyconnID;\nEND","joinLobby":"CREATE DEFINER=`root`@`localhost` PROCEDURE `joinLobby`(\n\tin myid INT,\n    in newJson json    \n)\nBEGIN\n\tupdate lobby set lobbyjson = JSON_MERGE_PRESERVE(lobbyjson,newJson) where connID = myid;\n    select JSON_UNQUOTE(lobbyjson -> '$.users[*]') as usrs, JSON_UNQUOTE(lobbyjson -> '$.leader') as leader from lobby where connID = myid;\nEND","setLobbyStatus":"CREATE DEFINER=`root`@`localhost` PROCEDURE `setLobbyStatus`(\n\tIN myID INT,\n    IN incStatus varchar(16)\n)\nBEGIN\n\tupdate lobby set lobbyjson = JSON_SET(lobbyjson,'$.status',incStatus) where connID = myID;\nEND","updateLobby":"CREATE DEFINER=`root`@`localhost` PROCEDURE `updateLobby`(\n\tIN lobbyconnID INT,\n    IN uJson json\n)\nBEGIN\n    update lobby set lobbyjson = JSON_MERGE_PATCH(lobbyjson,uJson) where connID = lobbyconnID;\n    select lobbyjson from lobby where connID = lobbyconnID;\nEND"},"tables":{"lobby":"CREATE TABLE `lobby` (\n  `id` int NOT NULL AUTO_INCREMENT,\n  `lobbyjson` json DEFAULT NULL,\n  `connID` int DEFAULT (lpad((rand() * 1000000),5,_utf8mb4'0')),\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `id_UNIQUE` (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='for handling lobby json'"}}
